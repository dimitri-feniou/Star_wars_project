---
title: "Projet Gestion & Analyse de donn√©es massives"
author: "Maillot Roberto, AMMOR Ismail,FENIOU Dimitri"
date: "enseign√© par Fr√©d√©ric BLANCHARD & Joris FALIP // 2019"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
---
<div style="text-align: justify">
```{r setup, include=FALSE}
# ne touchez pas a ce bloc sinon je bouge
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
personnages <- starwars[,c(2,3,11)]
personnages <- na.omit(personnages)
# vraiment, pas touche
```

## Modalit√©s d'√©valuation
Comme au semestre pr√©c√©dent, le but de ce projet est de vous permettre d'exercer tout ce que vous avez appris lors de ce module. Fournissez des r√©ponses d√©taill√©es permettant d'appr√©cier √† leur juste valeur vos comp√©tences, n'h√©sitez donc pas √† prendre l'initiative et √©toffer chaque question d'explications sur votre d√©marche, sur les choix que vous avez op√©r√©, et √† inclure √©ventuellement d'autres analyses suppl√©mentaires qui vous semblent compl√©ter judicieusement la r√©ponse.

#### Consignes
Pour chaque question, la r√©ponse doit comporter √† la fois du code r√©alisant ce qui est attendu, mais aussi une explication textuelle de la logique derri√®re votre r√©ponse.

* Le code doit figurer dans les blocs de code pour chaque question.
* Les r√©ponses textuelles doivent figurer sous le bloc de code de la question.
* En cliquant sur _knit_, tout le code du fichier doit s'executer sans erreur.
* Ne m√©langez pas visualiser/afficher et affecter.
* Ecrivez un ode lisibile, avec des espaces, des noms de variables appropri√©s et clairs, etc...
* Aucun autre format que RMardown (ce document) ne sera accept√©.

#### Date et m√©thode de rendu
A cause des d√©lais de saisie des notes, le projet doit **imp√©rativement** √™tre envoy√© par email √† [joris.falip@univ-reims.fr](mailto:joris.falip@univ-reims.fr) le dimanche 5 mai **au plus tard**. Le seul document √† envoyer est ce fichier l√†, que vous prendrez le soin de renommer **nom1-nom2.Rmd**. Vous remplacerez aussi "AUTHORS NAMES" dans l'ent√™te de ce fichier par vos noms.

## Sujet

### Pr√©-requis

Afin de pouvoir r√©aliser ce projet, quelques packages sont n√©cessaires : _dplyr_, _ggplot2_, _prettydoc_, _class_, _jsonlite_, _rvest_, _rpart_ et _rpart.plot_. Pensez donc √† les installer s'ils ne sont pas d√©j√† install√©s sur votre machine, et √† les charger quand vous en aurez besoin.
```{r include=FALSE} 
# Chargement des library

library(prettydoc)
library(dplyr)
library(ggplot2)
library(class)
library(jsonlite)
library(rvest)
library(rpart)
library(rpart.plot)

```
### Star Wars API

[https://swapi.dev/api/](https://swapi.dev/api/) est un site proposant une API qui recense des donn√©es sur l'univers de Star Wars. N'oubliez pas d'aller consulter la documentation disponible sur le site pour en comprendre l'utilisation.

##### Question 1

R√©cup√©rez, via une requ√™te aupr√®s de l'API du site, les informations sur le premier film. Acc√©dez √† sa date de sortie (_release date_).

```{r question1}
# R√©cup√©ration de l'url   
url <- 'https://swapi.dev/api/films/1/'
webpage <- fromJSON(url)

# R√©cup√©ration des informations dont on a besoin
webpage$release_date
webpage$title
webpage$episode_id
webpage$producer
webpage$director
webpage$planets


 
```
<p style="text-align:justify";># On a charg√© les 2 packages pour acc√©der aux donn√©es du site, on a donn√© un nom √† l'url puis on a appliqu√© le jsonlite sur le site et enfin on a importer le titre, la date de publication, les planets et les informations sur le film.
 </p>
##### Question 2

Cr√©ez une fonction qui, √† partir de l'URL [https://swapi.dev/api/](https://swapi.dev/api/) d'un film, affiche le climat de toutes les plan√®tes de ce film.
```{r question2}


climatePlanete <- function(url){
  webpage <-fromJSON(url)
  nbPlanete <- webpage$planets
  for (nu in nbPlanete){
    webpage <- fromJSON(nu)
    print(webpage$climate)
  }
}
climatePlanete("https://swapi.dev/api/films/1/")


```
<p style="text-align:justify";> Nous avons commenc√© par cr√©er la fonction nomm√©e climatePlanete qui prend en argument l'url d'un film, on a ensuite r√©cuperer gr√¢ce √† une requete vers l'api l'url des planetes du film et gr√¢ce √† une boucle nous parcourons chacun des urls pour y afficher les climats de chaque planetes
 </p>
### Sens Critique

[www.senscritique.com](www.senscritique.com) ne propose pas d'API pour acc√©der directement aux donn√©es, il va donc falloir r√©cup√©rer autrement les informations du site.

##### Question 3

R√©cup√©rez, sur ce site, la note obtenue par le premier film de la saga Star Wars. Le node √† utiliser est **.pvi-scrating-value**.

```{r question3}
library(rvest)
# R√©cup√©ration de l'url 
sensCritique_url <- 'https://www.senscritique.com/film/La_Guerre_des_Etoiles/365132' 
webpage <- read_html(sensCritique_url)

#Selection du Node
rating_html <- html_nodes(webpage,'.pvi-scrating-value') 
rating_movie <- html_text(rating_html)

#Affichage du rating
print(rating_movie)


```
<p style="text-align:justify";> le site SensCritique ne proposant pas d'API nous nous sommes servis de la library rvest pour acc√©der au Node **'pvi-scrating-value'**et extraire le rating du premier film de la saga. </p>

##### Question 4

R√©cup√©rez maintenant le nombre de critiques, de coups de coeur et de personnes ayant mis le film dans leur liste d'envies. Allez chercher dans le code source de la page, le m√™me node vous donnera ces trois informations d'un coup. Pensez √† √©crire le nom du node correctement : par exemple pour r√©cup√©rer le titre d'un film il s'agit de **d-heading2-opt** dans le code de la page, mais il faut √©crire **.d-heading2-opt** dans R pour r√©cup√©rer ce node.

```{r question4}
library("rvest")

#Recup√©ration du Node '.d-heading2-opt'

sensCritique_url2 <-"https://www.senscritique.com/film/La_Guerre_des_Etoiles/365132"
webpage <- read_html(sensCritique_url2)
critiques <- html_nodes(webpage,'.d-heading2-opt')

#Transformation des critique en str et affichage
nomCrtitique <- html_text(critiques)
print(nomCrtitique[4])

#Transformation des coups de coeur en str et affichage
coeur <- html_nodes(webpage,'.pvi-stats-number')
nbcoeur <- html_text(coeur)
print(nbcoeur)

```

### Analyses

Pour ces questions, vous devrez utiliser un jeu de donn√©es d√©j√† fourni au d√©but de ce document et portant le nom **personnages**. Ce jeu de donn√©es contient le poids, la taille, et l'esp√®ce de cinquante huit personnages de la saga.

##### Question 5

A l'aide de notre fid√®le package _ggplot2_, cr√©ez un nuage de point visualisant les poids et tailles de chaque personnage. Vous √©tudierez ensuite √† l'aide d'un historgramme la r√©partition des poids de ces personnages : notez-vous quelque chose de particulier ? Chacun de vos deux graphes devra √™tre joli : l√©gende, titre, descriptions des axes. Vous utilisez aussi la colonne _species_ du dataframe pour colorer les deux graphes.

```{r question5}
# Chargement des packages
library('ggplot2')

# R√©cuparation des infomations sur les personnages de star wars que le prof a gentiment donn√©

personnages <- starwars[,c(2,3,11)]
personnages <- na.omit(personnages)

# Cr√©ation du graphique scater plot

qplot(height,mass, data = personnages, geom = "point",
      main = 'Analyse des personnages Star Wars en fonction de la taille et du poids',
      xlab = 'Taille',ylab = 'Poids',
      color = species,)

# Cr√©ation du diagramme en barre

qplot(mass, data=personnages, geom="histogram",
      main = 'Analyse des personnages Star Wars en fonction de leur taille et poids',
      xlab = 'Poids',
      color = species,)
```

<p style="text-align:justify";> On peut voir qu'un personnage ce d√©marque par son poid : c'est jabba the hutt ! </p>

<img src="https://media.giphy.com/media/3oeSAK2k0zDaQCbqJG/giphy.gif" width="700" height="300" />


##### Question 6

Cr√©ez et affichez un arbre de d√©cision pour d√©terminer l'esp√®ce d'un personnage √† partir du poids et de la taille.

```{r question6}
#Cr√©ation de l'arbre de decision
arbre.classif<-rpart(species ~ mass + height ,personnages)
rpart.plot(arbre.classif)
```

##### Question 7

Utilisez l'algorithme de clustering de sk-moyennes pour regrouper les personnages en plusieurs groupes selon leur taille et poids. Le nombre de groupes est laiss√© √† votre appr√©ciation.

```{r question7}
# On garde seulement les valeurs poids et taille pour les analyser
stars1 <- (personnages[,1:2])
km <- kmeans(stars1, 3)
class(personnages)

# Cr√©ation d'un diagramme de dispersion pour visualiser les groupes
palette <- c("red", "green", "blue")
couleurs <- palette[km$cluster]
plot(stars1, pch =21, bg= couleurs)

```

##### Question 8

Transformez le dataframe **personnages** en une matrice que vous nommerez **matpersonnages**. Ajoutez ensuite l'individu suivant (_height_ = 231, _mass_ = 122) √† la matrice en lui rajoutant une 59√®me ligne. Pr√©disez son esp√®ce grace aux k-NN, en utilisant les autres donn√©es et en vous basant sur les 3 plus proches voisins.

```{r question8}
# Chargement des donnÈes 
library(class)
# On transforme notre DataFrame personnage en matrice
matpersonnages <- as.matrix(personnages)
# On crÈe un 
new_perso <- c(231,122,NA)
# On ajoute notre individu ‡ notre matrice 
matpersonnages <- rbind(matpersonnages,new_perso)
# On test notre nouvelle individu pour connaÓtre son espËce en fonction de ces 3 plus proche voisin
spec_new_perso <- knn(train = matpersonnages[1:58,1:2],
                      test = matpersonnages[59,1:2],
                      cl = matpersonnages[1:58,3],
                      k = 3)
print(spec_new_perso)
```
<p style="text-align:justify";>Notre nouvelle individu est un Wookie.</p>
</div>

<img src ="https://media.giphy.com/media/69pKX6fv2QgTe/giphy.gif"
width="700" height="300" />